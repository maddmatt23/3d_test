<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Know-Hub — 3D Scroll Experience</title>
  <style>
    :root{
      --bg-light: #f7f7f8;
      --bg-dark: #e3e4e8;
      --panel: #ffffff;
      --panel-border: #dcdde1;
      --text: #222;
      --muted: #666;
      --accent: #ff6a00;
      --accent2:#2ea8ff;
    }
    html, body {
      margin:0;
      background: linear-gradient(180deg, var(--bg-light), var(--bg-dark));
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      overflow-x:hidden;
    }

    /* Fixed dark overlay; opacity driven after reveal */
    #bgDark {
      position: fixed; inset: 0; z-index: 4;
      background: #000;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s linear;
    }

    /* Navbar */
    nav{
      position: fixed; inset: 16px 16px auto 16px; height: 52px;
      display:flex; align-items:center; justify-content:space-between;
      padding: 0 16px;
      background: rgba(255,255,255,0.75);
      border: 1px solid var(--panel-border);
      border-radius: 14px;
      backdrop-filter: blur(10px);
      z-index: 60;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    }
    .brand{
      font-weight: 700; font-size: 18px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .nav-links{ display:flex; gap:12px; }
    .nav-btn{
      padding:8px 14px; border-radius: 10px; font-weight:500;
      background: #fff;
      border:1px solid var(--panel-border);
      color: var(--text);
      cursor:pointer; font-size:14px;
      transition: all .15s ease;
    }
    .nav-btn:hover{ background:#f0f0f0; }

    /* Title with pill background */
    header#title{
      position: fixed; top: 90px; left:50%; transform: translateX(-50%);
      z-index: 40;
      font-size: clamp(28px, 6vw, 56px);
      font-weight: 700; letter-spacing:.02em;
      color: var(--text);
      pointer-events:none; transition: opacity .2s linear, background .2s linear, box-shadow .2s linear;
      background: rgba(255,255,255,0.6);
      padding: 10px 18px;
      border-radius: 14px;
      box-shadow: 0 4px 18px rgba(0,0,0,.08);
      border: 1px solid var(--panel-border);
    }

    /* Fixed canvas */
    #stage{
      position: fixed; inset: 0; width: 100%; height:100%;
      z-index: 5; pointer-events: none;
      transition: filter .12s linear;
    }

    /* Content */
    .wrap{ max-width: 1000px; margin: 0 auto; padding: 140px 20px 60px; position:relative; z-index: 20; }
    section{ margin: 120px 0; }
    .panel{
      border-radius: 16px;
      background: var(--panel);
      border: 1px solid var(--panel-border);
      padding:28px;
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
    }
    .panel h2{ margin:0 0 8px 0; }
    .spacer{ height: 450vh; } /* ensure enough scroll to hit full rotation */

    /* Bordered photo card (revealed around the angle trigger) */
    .photo-card{
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 24px;
      border-radius: 18px;
      border: 1px solid var(--panel-border);
      background: rgba(255,255,255,0.92);
      box-shadow: 0 10px 28px rgba(0,0,0,.08);
      padding: 22px;
      align-items: center;
      transform: translateY(20px);
      opacity: 0;
      transition: opacity .35s ease, transform .35s ease, background .25s ease, border-color .25s ease;
    }
    .photo-card h3{ margin:0 0 8px 0; }
    .photo-card p { margin:0; color: var(--muted); }
    .photo-card img{
      width: 100%; border-radius: 14px;
      border: 1px solid var(--panel-border);
      box-shadow: 0 8px 22px rgba(0,0,0,.08);
      background: #f2f2f2;
      display: block;
      object-fit: cover;
      aspect-ratio: 16/10;
    }
    @media (max-width: 900px){
      .photo-card{ grid-template-columns: 1fr; }
    }

    /* Debug chip */
    #log{
      position: fixed; bottom: 18px; left: 18px; z-index: 70;
      background: rgba(0,0,0,0.72); color: #9cf19b;
      padding:6px 10px; border-radius: 8px;
      font: 12px ui-monospace;
    }
  </style>
</head>
<body>
  <!-- Dark fade overlay -->
  <div id="bgDark"></div>

  <!-- Navbar -->
  <nav>
    <div class="brand">Know-Hub</div>
    <div class="nav-links">
      <button class="nav-btn">Home</button>
      <button class="nav-btn">About</button>
      <button class="nav-btn">Products</button>
      <button class="nav-btn">Contact</button>
    </div>
  </nav>

  <!-- Title -->
  <header id="title">Know-Hub</header>

  <!-- Content above -->
  <div class="wrap">
    <section class="panel">
      <h2>Welcome to Know-Hub</h2>
      <p>Scroll to rotate the 3D model. HDR lighting adds realistic reflections. When content overlaps, the model softens so text stays readable.</p>
    </section>
  </div>

  <!-- Fixed canvas -->
  <canvas id="stage"></canvas>

  <!-- Content below -->
  <div class="wrap">
    <section class="panel">
      <h2>Modern & Minimal</h2>
      <p>A clean gray→white gradient background with subtle accents — product stays the hero.</p>
    </section>

    <!-- Reveals between ~140° and ~200° -->
    <section id="revealSection" class="photo-card">
      <img src="models/phototest.jpg" alt="Showcase" onerror="this.src='models/phototest.png'">
      <div>
        <h3>Precision Meets Presence</h3>
        <p>As you explore further, the page subtly shifts to a darker mood, giving imagery and copy center stage.</p>
      </div>
    </section>

    <section class="panel">
      <h2>Scroll-Driven Focus</h2>
      <p>Full 360° rotation over the page scroll. Background darkens after the reveal, guiding attention to the story.</p>
    </section>
  </div>

  <div class="spacer"></div>
  <div id="log">Loading…</div>

  <!-- Three.js (r0.128) + loaders -->
  <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>

  <script>
    const titleEl = document.getElementById('title');
    const canvasEl = document.getElementById('stage');
    const bgDark   = document.getElementById('bgDark');
    const revealEl = document.getElementById('revealSection');
    const logEl    = document.getElementById('log');
    const log = m => { logEl.textContent = m; };

    // Three.js
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(35, window.innerWidth/window.innerHeight, 0.1, 100);
    camera.position.set(0, 0.5, 2.5);

    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true, canvas: canvasEl });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.0;
    renderer.outputEncoding = THREE.sRGBEncoding;

    // Base light
    scene.add(new THREE.HemisphereLight(0xffffff, 0xaaaaaa, 0.35));

    // HDR with PMREM
    const pmrem = new THREE.PMREMGenerator(renderer);
    pmrem.compileEquirectangularShader();
    new THREE.RGBELoader()
      .setPath('models/')
      .load('studio_small_08_1k.hdr', (hdrTex) => {
        const envMap = pmrem.fromEquirectangular(hdrTex).texture;
        scene.environment = envMap;
        hdrTex.dispose(); pmrem.dispose();
        log('HDR loaded ✅');
      }, undefined, (err) => {
        log('HDR load error ❌ (check models/studio_small_08_1k.hdr)'); console.error(err);
      });

    // Load GLB
    const loader = new THREE.GLTFLoader();
    let model = null;
    loader.load('models/test.glb', (gltf)=>{
      model = gltf.scene;

      // Center & scale; vertical centering
      const box = new THREE.Box3().setFromObject(model);
      const size = new THREE.Vector3(); box.getSize(size);
      const center = new THREE.Vector3(); box.getCenter(center);
      const maxDim = Math.max(size.x, size.y, size.z) || 1.0;

      const scale = 1.0 / maxDim;
      model.scale.setScalar(scale);
      model.position.sub(center.multiplyScalar(scale));
      model.position.y += 0.5;  // visually centered

      scene.add(model);
      log('Model loaded ✅');
      animate();
    }, (xhr)=>{
      if (xhr.total) log(`Loading model… ${(xhr.loaded/xhr.total*100).toFixed(0)}%`);
    }, (err)=>{
      log('Model load error ❌ (check models/test.glb)'); console.error(err);
    });

    // Helpers
    function scrollProgress(){
      const max = document.body.scrollHeight - window.innerHeight;
      return max > 0 ? window.scrollY / max : 0;
    }
    function maxOverlapRatio(){
      let maxR = 0;
      document.querySelectorAll('.wrap').forEach(sec=>{
        const r = sec.getBoundingClientRect();
        if (r.bottom <= 0 || r.top >= window.innerHeight) return;
        const visible = Math.min(window.innerHeight, r.bottom) - Math.max(0, r.top);
        const ratio = Math.max(0, Math.min(1, visible / window.innerHeight));
        if (ratio > maxR) maxR = ratio;
      });
      return maxR;
    }
    function clamp(x, a, b){ return Math.max(a, Math.min(b, x)); }

    // Animate
    function animate(){
      requestAnimationFrame(animate);

      const p = scrollProgress();          // 0–1
      const angleDeg = p * 360.0;

      if(model){
        model.rotation.y = p * Math.PI * 2;  // full 360°
      }

      // Title fade near top
      const fadePoint = window.innerHeight * 0.4;
      titleEl.style.opacity = Math.max(0, 1 - window.scrollY / fadePoint).toFixed(2);

      // Blur canvas while content overlaps
      const overlap = maxOverlapRatio();              // 0–1
      const blurPx  = overlap * 6;                    // up to 6px
      const dim     = 1 - overlap * 0.15;             // slight dim
      canvasEl.style.filter = `blur(${blurPx.toFixed(1)}px) brightness(${dim.toFixed(2)})`;

      // Reveal photo card ~140° → 200° and fade background to black
      const startDeg = 140;
      const endDeg   = 200;
      const t = clamp((angleDeg - startDeg) / (endDeg - startDeg), 0, 1); // 0→1

      revealEl.style.opacity = t.toFixed(2);
      revealEl.style.transform = `translateY(${(1 - t) * 20}px)`;
      bgDark.style.opacity = (t * 1.0).toFixed(2);

      // As background darkens, strengthen title pill slightly for contrast
      const titleBgAlpha = 0.6 + t * 0.2; // 0.6 → 0.8
      titleEl.style.background = `rgba(255,255,255,${titleBgAlpha.toFixed(2)})`;
      titleEl.style.boxShadow = `0 4px 18px rgba(0,0,0,${(0.08 + t*0.12).toFixed(2)})`;

      // (Optional) debug current angle
      // log(`Angle: ${angleDeg.toFixed(0)}°`);

      renderer.render(scene, camera);
    }

    // Resize
    window.addEventListener('resize', ()=>{
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Know-Hub — 3D Scroll Experience</title>
  <style>
    :root{
      --bg-light: #f7f7f8;
      --bg-dark: #e3e4e8;
      --panel: #ffffff;
      --panel-border: #dcdde1;
      --text: #222;
      --muted: #666;
      --accent: #ff6a00;
      --accent2:#2ea8ff;
    }
    html, body {
      margin:0;
      background: linear-gradient(180deg, var(--bg-light), var(--bg-dark));
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      overflow-x:hidden;
    }
    /* Navbar */
    nav{
      position: fixed; inset: 16px 16px auto 16px; height: 52px;
      display:flex; align-items:center; justify-content:space-between;
      padding: 0 16px;
      background: rgba(255,255,255,0.75);
      border: 1px solid var(--panel-border);
      border-radius: 14px;
      backdrop-filter: blur(10px);
      z-index: 60;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    }
    .brand{
      font-weight: 700; font-size: 18px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .nav-links{ display:flex; gap:12px; }
    .nav-btn{
      padding:8px 14px; border-radius: 10px; font-weight:500;
      background: #fff;
      border:1px solid var(--panel-border);
      color: var(--text);
      cursor:pointer; font-size:14px;
      transition: all .15s ease;
    }
    .nav-btn:hover{ background:#f0f0f0; }

    /* Title */
    header#title{
      position: fixed; top: 90px; left:50%; transform: translateX(-50%);
      z-index: 40;
      font-size: clamp(28px, 6vw, 56px);
      font-weight: 700; letter-spacing:.02em;
      color: var(--text);
      pointer-events:none; transition: opacity .2s linear;
    }

    /* Fixed canvas */
    #stage{
      position: fixed; inset: 0; width: 100%; height:100%;
      z-index: 5; pointer-events: none;
      transition: filter .12s linear;
    }

    /* Content */
    .wrap{ max-width: 1000px; margin: 0 auto; padding: 140px 20px 60px; position:relative; z-index: 20; }
    section{ margin: 120px 0; }
    .panel{
      border-radius: 16px;
      background: var(--panel);
      border: 1px solid var(--panel-border);
      padding:28px;
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
    }
    .panel h2{ margin:0 0 8px 0; }
    .spacer{ height: 300vh; }

    /* Debug chip */
    #log{
      position: fixed; bottom: 18px; left: 18px; z-index: 70;
      background: rgba(0,0,0,0.72); color: #9cf19b;
      padding:6px 10px; border-radius: 8px;
      font: 12px ui-monospace;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="brand">Know-Hub</div>
    <div class="nav-links">
      <button class="nav-btn">Home</button>
      <button class="nav-btn">About</button>
      <button class="nav-btn">Products</button>
      <button class="nav-btn">Contact</button>
    </div>
  </nav>

  <!-- Title -->
  <header id="title">Know-Hub</header>

  <!-- Content above -->
  <div class="wrap">
    <section class="panel">
      <h2>Welcome to Know-Hub</h2>
      <p>Scroll to rotate the 3D model. HDR lighting adds realistic reflections. When content overlaps, the model softens so text stays readable.</p>
    </section>
  </div>

  <!-- Fixed canvas -->
  <canvas id="stage"></canvas>

  <!-- Content below -->
  <div class="wrap">
    <section class="panel">
      <h2>Modern & Minimal</h2>
      <p>Soft gray-to-white background, subtle accents, and focus on the product.</p>
    </section>
    <section class="panel">
      <h2>Scroll-Driven Focus</h2>
      <p>Full 360° rotation over the page scroll. Background blur tracks overlap with these panels.</p>
    </section>
  </div>

  <div class="spacer"></div>
  <div id="log">Loading…</div>

  <!-- Three.js (r0.128) + loaders -->
  <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>

  <script>
    const titleEl = document.getElementById('title');
    const canvasEl = document.getElementById('stage');
    const logEl = document.getElementById('log');
    const log = m => { logEl.textContent = m; };

    // Three.js
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(35, window.innerWidth/window.innerHeight, 0.1, 100);
    camera.position.set(0, 0.5, 2.5);

    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true, canvas: canvasEl });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.0;
    renderer.outputEncoding = THREE.sRGBEncoding;

    // Mild base light (most lighting comes from HDR env)
    scene.add(new THREE.HemisphereLight(0xffffff, 0xaaaaaa, 0.35));

    // ✅ HDR environment with PMREM (reliable in r0.128)
    const pmrem = new THREE.PMREMGenerator(renderer);
    pmrem.compileEquirectangularShader();

    new THREE.RGBELoader()
      .setPath('models/')
      .load('studio_small_08_1k.hdr', (hdrTex) => {
        const envMap = pmrem.fromEquirectangular(hdrTex).texture;
        scene.environment = envMap;
        hdrTex.dispose();
        pmrem.dispose();
        log('HDR loaded ✅');
      }, undefined, (err) => {
        log('HDR load error ❌ (check models/studio_small_08_1k.hdr)');
        console.error(err);
      });

    // Load GLB
    const loader = new THREE.GLTFLoader();
    let model = null;
    loader.load('models/test.glb', (gltf)=>{
      model = gltf.scene;

      // Center & scale; raise to visual center
      const box = new THREE.Box3().setFromObject(model);
      const size = new THREE.Vector3(); box.getSize(size);
      const center = new THREE.Vector3(); box.getCenter(center);
      const maxDim = Math.max(size.x, size.y, size.z) || 1.0;

      const scale = 1.0 / maxDim;   // comfortable size
      model.scale.setScalar(scale);
      model.position.sub(center.multiplyScalar(scale));
      model.position.y += 0.5;      // ⬆ bring up to center

      scene.add(model);
      log('Model loaded ✅');
      animate();
    }, (xhr)=>{
      if (xhr.total) log(`Loading model… ${(xhr.loaded/xhr.total*100).toFixed(0)}%`);
    }, (err)=>{
      log('Model load error ❌ (check models/test.glb)');
      console.error(err);
    });

    // Progress helpers
    function scrollProgress(){
      const max = document.body.scrollHeight - window.innerHeight;
      return max > 0 ? window.scrollY / max : 0;
    }
    function maxOverlapRatio(){
      // Measure how much any .wrap block overlaps the viewport (0–1)
      let maxR = 0;
      document.querySelectorAll('.wrap').forEach(sec=>{
        const r = sec.getBoundingClientRect();
        if (r.bottom <= 0 || r.top >= window.innerHeight) return;
        const visible = Math.min(window.innerHeight, r.bottom) - Math.max(0, r.top);
        const ratio = Math.max(0, Math.min(1, visible / window.innerHeight));
        if (ratio > maxR) maxR = ratio;
      });
      return maxR;
    }

    // Animate
    function animate(){
      requestAnimationFrame(animate);

      if(model){
        const p = scrollProgress();
        model.rotation.y = p * Math.PI * 2; // full 360°
      }

      // Fade title near top
      const fadePoint = window.innerHeight * 0.4;
      titleEl.style.opacity = Math.max(0, 1 - window.scrollY / fadePoint).toFixed(2);

      // ✅ Blur while content overlaps (sharp when clear)
      const overlap = maxOverlapRatio();              // 0–1
      const blurPx  = overlap * 6;                    // up to 6px, tasteful
      const dim     = 1 - overlap * 0.15;             // slight dimming
      canvasEl.style.filter = `blur(${blurPx.toFixed(1)}px) brightness(${dim.toFixed(2)})`;

      renderer.render(scene, camera);
    }

    // Resize
    window.addEventListener('resize', ()=>{
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="data:,">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Know-Hub — 3D Scroll Experience</title>
  <style>
    :root{
      --bg-light:#f7f7f8; --bg-dark:#e3e4e8;
      --panel:#ffffff; --panel-border:#dcdde1;
      --text:#222; --muted:#666;
      --accent:#ff6a00; --accent2:#2ea8ff;
    }
    html, body{ margin:0; background:linear-gradient(180deg,var(--bg-light),var(--bg-dark)); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; overflow-x:hidden; }

    /* Dark overlay after reveal */
    #bgDark{ position:fixed; inset:0; z-index:4; background:#000; opacity:0; pointer-events:none; transition:opacity .25s linear; }

    /* Navbar */
    nav{ position:fixed; inset:16px 16px auto 16px; height:52px; display:flex; align-items:center; justify-content:space-between; padding:0 16px; z-index:60; background:rgba(255,255,255,.75); border:1px solid var(--panel-border); border-radius:14px; backdrop-filter:blur(10px); box-shadow:0 4px 16px rgba(0,0,0,.06); }
    .brand{ font-weight:700; font-size:18px; background:linear-gradient(90deg,var(--accent),var(--accent2)); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .nav-links{ display:flex; gap:12px; }
    .nav-btn{ padding:8px 14px; border-radius:10px; font-weight:500; cursor:pointer; background:#fff; border:1px solid var(--panel-border); color:var(--text); transition:background .15s ease, transform .15s ease, box-shadow .15s ease; }
    .nav-btn:hover{ background:#f0f0f0; transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,.08); }

    /* Title pill */
    header#title{ position:fixed; top:90px; left:50%; transform:translateX(-50%); z-index:40; font-size:clamp(28px,6vw,56px); font-weight:700; letter-spacing:.02em; color:var(--text); pointer-events:none; background:rgba(255,255,255,.6); padding:10px 18px; border-radius:14px; border:1px solid var(--panel-border); box-shadow:0 4px 18px rgba(0,0,0,.08); transition:opacity .2s linear, background .2s linear, box-shadow .2s linear; }

    /* Fixed 3D hero */
    #stage{ position:fixed; inset:0; width:100%; height:100%; z-index:5; pointer-events:none; transition:filter .12s linear; }

    /* Content */
    .wrap{ max-width:1000px; margin:0 auto; padding:140px 20px 60px; position:relative; z-index:20; }
    section{ margin:120px 0; }
    .panel{ border-radius:16px; background:var(--panel); padding:28px; border:1px solid var(--panel-border); box-shadow:0 6px 18px rgba(0,0,0,.06); }
    .panel h2{ margin:0 0 8px 0; }

    /* Photo reveal card */
    .photo-card{ display:grid; grid-template-columns:1.2fr 1fr; gap:24px; border-radius:18px; border:1px solid var(--panel-border); background:rgba(255,255,255,.92); box-shadow:0 10px 28px rgba(0,0,0,.08); padding:22px; align-items:center; transform:translateY(20px); opacity:0; transition:opacity .35s ease, transform .35s ease, background .25s ease, border-color .25s ease; }
    .photo-card h3{ margin:0 0 8px 0; }
    .photo-card p{ margin:0; color:var(--muted); }
    .photo-card img{ width:100%; height:auto; border-radius:14px; display:block; object-fit:cover; border:1px solid var(--panel-border); background:#f2f2f2; aspect-ratio:16/10; box-shadow:0 8px 22px rgba(0,0,0,.08); }
    @media (max-width:900px){ .photo-card{ grid-template-columns:1fr; } }

    /* Card grid */
    .card-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:24px; }
    .card{ background:#fff; border-radius:12px; overflow:hidden; border:1px solid var(--panel-border); box-shadow:0 4px 14px rgba(0,0,0,.06); display:flex; flex-direction:column; transition:transform .2s ease, box-shadow .2s ease; }
    .card:hover{ transform:translateY(-4px); box-shadow:0 8px 20px rgba(0,0,0,.1); }
    .card img{ width:100%; height:180px; object-fit:cover; }
    .card-body{ padding:16px; }
    .card-body h3{ margin:8px 0; font-size:18px; }
    .card-body p{ margin:4px 0; color:var(--muted); font-size:14px; }
    .card-tag{ font-size:12px; font-weight:600; color:var(--accent); text-transform:uppercase; margin-bottom:4px; }

    /* Video section */
    .video-wrap{ margin-top:60px; }
    .video-frame{
      position:relative; width:100%;
      aspect-ratio:16/9; /* 1920x1080 */
      background:#000; border:1px solid var(--panel-border); border-radius:14px;
      overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,.10);
    }
    .video-frame video{ width:100%; height:100%; object-fit:cover; display:block; }

    /* Extra scroll so we hit 360° */
    .spacer{ height:450vh; }

    /* ===== Loader overlay ===== */
    #loader{ position:fixed; inset:0; z-index:80; display:grid; place-items:center; background:linear-gradient(180deg, var(--bg-light), var(--bg-dark)); transition:opacity .35s ease; }
    #loader.hide{ opacity:0; pointer-events:none; }
    .loader-card{ width:min(420px, 90vw); background:#fff; border:1px solid var(--panel-border); border-radius:16px; padding:18px 20px; box-shadow:0 10px 30px rgba(0,0,0,.1); }
    .loader-row{ display:flex; align-items:center; gap:12px; }
    .spinner{ width:28px; height:28px; border-radius:50%; border:3px solid #ddd; border-top-color: var(--accent); animation:spin 1s linear infinite; }
    @keyframes spin{ to{ transform:rotate(360deg); } }
    .progress{ margin-top:12px; height:8px; border-radius:999px; background:#ececec; overflow:hidden; }
    .progress > i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition: width .2s ease; }
    .pct{ margin-left:auto; font:600 14px/1.2 ui-sans-serif, system-ui; color:#333; }
    .hint{ margin-top:10px; font:12px/1.4 ui-sans-serif, system-ui; color:#666; }

    /* Scroll hint chip */
    .scroll-hint{ position:fixed; bottom:20px; left:50%; transform:translateX(-50%); z-index:50; background:rgba(255,255,255,.9); border:1px solid var(--panel-border); border-radius:999px; padding:8px 14px; font:500 13px/1 ui-sans-serif; box-shadow:0 6px 16px rgba(0,0,0,.08); opacity:0; transition:opacity .35s ease; }
    .scroll-hint.show{ opacity:1; }

    /* ===== Entry overlay with lightbulb ===== */
    #entry{ position:fixed; inset:0; z-index:70; display:grid; place-items:center; background:rgba(255,255,255,.55); backdrop-filter: blur(8px); transition:opacity .35s ease; }
    #entry.hide{ opacity:0; pointer-events:none; }
    .entry-card{ display:flex; flex-direction:column; align-items:center; gap:14px; background:#fff; border:1px solid var(--panel-border); border-radius:18px; padding:22px 26px; box-shadow:0 10px 28px rgba(0,0,0,.12); }
    .entry-btn{ display:flex; align-items:center; gap:10px; padding:10px 16px; border-radius:12px; border:1px solid var(--panel-border); background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#fff; font-weight:700; cursor:pointer; box-shadow:0 8px 18px rgba(0,0,0,.1); }
    .entry-btn svg{ width:20px; height:20px; }
  </style>
</head>
<body>
  <!-- Loader -->
  <div id="loader">
    <div class="loader-card">
      <div class="loader-row">
        <div class="spinner"></div>
        <div>Preparing the experience…</div>
        <div class="pct" id="pct">0%</div>
      </div>
      <div class="progress"><i id="bar"></i></div>
      <div class="hint">Loading HDR lighting and 3D model. This only happens the first time.</div>
    </div>
  </div>

  <!-- Entry (click to start) -->
  <div id="entry" aria-hidden="true">
    <div class="entry-card">
      <div style="font-weight:800; font-size:18px;">Welcome to Know-Hub</div>
      <button id="enterBtn" class="entry-btn">
        <!-- lightbulb icon -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18h6M10 22h4"/>
          <path d="M2 11a10 10 0 1 1 20 0c0 3.2-1.6 5.2-3.5 6.8-.8.7-1.5 1.7-1.5 2.7H9c0-1-0.7-2-1.5-2.7C3.6 16.2 2 14.2 2 11z"/>
        </svg>
        Enter Know-Hub
      </button>
      <div style="font-size:12px; color:#666;">Click to begin the scroll experience</div>
    </div>
  </div>

  <!-- Background darkener -->
  <div id="bgDark"></div>

  <!-- Navbar -->
  <nav>
    <div class="brand">Know-Hub</div>
    <div class="nav-links">
      <button class="nav-btn">Home</button>
      <button class="nav-btn">About</button>
<a class="nav-btn" href="products.html">Products</a>
      <button class="nav-btn">Contact</button>
    </div>
  </nav>

  <!-- Title -->
  <header id="title">Know-Hub</header>

  <!-- Top content -->
  <div class="wrap">
    <section class="panel">
      <h2>Welcome to Know-Hub</h2>
      <p>Scroll to rotate the 3D model. HDR lighting adds realistic reflections. When content overlaps, the model softens so text stays readable.</p>
    </section>
  </div>

  <!-- Fixed 3D hero -->
  <canvas id="stage"></canvas>

  <!-- Middle content -->
  <div class="wrap">
    <section class="panel">
      <h2>Modern & Minimal</h2>
      <p>A clean gray→white gradient background with subtle accents — product stays the hero.</p>
    </section>

    <!-- Photo reveal section -->
    <section id="revealSection" class="photo-card">
      <img src="models/phototest.JPG" alt="Showcase" onerror="this.src='models/phototest.png'">
      <div>
        <h3>Precision Meets Presence</h3>
        <p>As you explore further, the page subtly shifts to a darker mood, giving imagery and copy center stage.</p>
      </div>
    </section>

    <!-- Video section -->
    <section class="panel video-wrap">
      <h2>Watch the Demo</h2>
      <p class="muted">A demo video? Wow.</p>
      <div class="video-frame">
        <video
          src="videos/yourvideo.mp4"
          controls
          preload="metadata"
          playsinline
          webkit-playsinline
          poster="models/test.jpg">
          Sorry, your browser doesn’t support the video tag.
        </video>
      </div>
    </section>
  </div>

  <!-- Card grid section -->
  <div class="wrap">
    <h2 style="margin-bottom:30px;">More from Know-Hub</h2>
    <div class="card-grid">
      <div class="card">
        <img src="models/phototest.JPG" alt="Sample 1" onerror="this.src='models/phototest.png'">
        <div class="card-body">
          <p class="card-tag">Read our blog</p>
          <h3>This is a test image</h3>
          <p>Did I tell you that this is a test image?</p>
        </div>
      </div>
      <div class="card">
        <img src="models/phototest.JPG" alt="Sample 2" onerror="this.src='models/phototest.png'">
        <div class="card-body">
          <p class="card-tag">Quick & easy</p>
          <h3>Oh wow! Another test image</h3>
          <p>You're aware that I have 2 test images on this page?</p>
        </div>
      </div>
      <div class="card">
        <img src="models/phototest.JPG" alt="Sample 3" onerror="this.src='models/phototest.png'">
        <div class="card-body">
          <p class="card-tag">Helping the planet</p>
          <h3>Test image number 3???</h3>
          <p>Wowee, I am going off today! 3 test images!</p>
        </div>
      </div>
    </div>
  </div>

  <div class="spacer"></div>

  <!-- Local libs -->
  <script src="libs/three.min.js"></script>
  <script src="libs/GLTFLoader.js"></script>
  <script src="libs/RGBELoader.js"></script>

<script>
  const titleEl = document.getElementById('title');
  const canvasEl = document.getElementById('stage');
  const bgDark   = document.getElementById('bgDark');
  const revealEl = document.getElementById('revealSection');
  const entryEl  = document.getElementById('entry');
  const enterBtn = document.getElementById('enterBtn');

  // Loader UI refs
  const loaderEl = document.getElementById('loader');
  const barEl = document.getElementById('bar');
  const pctEl = document.getElementById('pct');

  // Scroll hint
  const hint = document.createElement('div');
  hint.className = 'scroll-hint';
  hint.textContent = 'Scroll ↓';
  document.body.appendChild(hint);

  // ===== Three.js setup =====
  const scene = new THREE.Scene();

  // Camera
  const camera = new THREE.PerspectiveCamera(35, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(0.0, 1.0, 3.0);

  // Renderer
  const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true, canvas: canvasEl });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.physicallyCorrectLights = true;
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  renderer.toneMappingExposure = 0.8;            // darker overall so HDRI isn’t blown out
  renderer.outputEncoding = THREE.sRGBEncoding;

  // Soft shadows
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;

  // === Lights you will SEE ===
  const keyLight = new THREE.DirectionalLight(0xffffff, 1.35);
  keyLight.position.set(1.8, 3.0, 2.0);
  keyLight.castShadow = true;
  keyLight.shadow.mapSize.set(2048, 2048);
  keyLight.shadow.radius = 4;                    // softer edge
  keyLight.shadow.bias = -0.0005;
  scene.add(keyLight);

  const fillLight = new THREE.DirectionalLight(0xffffff, 0.55);
  fillLight.position.set(-2.0, 1.2, -1.5);
  scene.add(fillLight);

  const rimLight = new THREE.DirectionalLight(0xffffff, 0.4);
  rimLight.position.set(-1.2, 2.2, -2.6);
  scene.add(rimLight);

  // Subtle ambient
  scene.add(new THREE.AmbientLight(0xffffff, 0.12));

  // === STAGE GROUP (move everything together) ===
  const stage = new THREE.Group();
  scene.add(stage);

  // Ground shadow catcher (receives real shadow)
  const ground = new THREE.Mesh(
    new THREE.PlaneGeometry(12,12),
    new THREE.ShadowMaterial({ opacity: 0.28 })
  );
  ground.rotation.x = -Math.PI/2;
  ground.position.y = 0.0;
  ground.receiveShadow = true;
  stage.add(ground);

  // Soft contact shadow (extra fade around edges)
  function makeRadialTexture(size=512){
    const c = document.createElement('canvas');
    c.width = c.height = size;
    const ctx = c.getContext('2d');
    const g = ctx.createRadialGradient(size/2,size/2, size*0.1, size/2,size/2, size*0.5);
    g.addColorStop(0, 'rgba(0,0,0,0.25)');
    g.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,size,size);
    const tex = new THREE.CanvasTexture(c);
    tex.generateMipmaps = true;
    tex.minFilter = THREE.LinearMipmapLinearFilter;
    tex.magFilter = THREE.LinearFilter;
    return tex;
  }
  const contactTex = makeRadialTexture(512);
  const contactMesh = new THREE.Mesh(
    new THREE.PlaneGeometry(3.2, 3.2),
    new THREE.MeshBasicMaterial({ map: contactTex, transparent:true, opacity:0.9 })
  );
  contactMesh.rotation.x = -Math.PI/2;
  contactMesh.position.y = 0.001; // slightly above ground to avoid z-fighting
  stage.add(contactMesh);

  // Raise the whole stage (model + ground + contact)
  stage.position.y = 0.30; // <<< TUNE THIS to bring the 3D up/down

  // Progress
  let hdrProgress = 0, modelProgress = 0;
  function updateProgress() {
    const total = Math.max(0, Math.min(1, 0.3*hdrProgress + 0.7*modelProgress));
    barEl.style.width = (total*100).toFixed(0) + '%';
    pctEl.textContent = (total*100).toFixed(0) + '%';
  }

  // HDRI (dimmed) via PMREM
  const pmrem = new THREE.PMREMGenerator(renderer);
  pmrem.compileEquirectangularShader();

  new THREE.RGBELoader()
    .setPath('models/')
    .load('studio_small_08_1k.hdr',
      (hdr) => {
        const envMap = pmrem.fromEquirectangular(hdr).texture;
        scene.environment = envMap;             // reflections only; keep CSS bg
        hdr.dispose(); pmrem.dispose();
        hdrProgress = 1; updateProgress();
      },
      (xhr) => {
        hdrProgress = xhr && xhr.total ? xhr.loaded / xhr.total : Math.min(1, hdrProgress + 0.02);
        updateProgress();
      },
      (e) => { console.error('HDR load error', e); hdrProgress = 1; updateProgress(); }
    );

  // Load GLB
  const loader = new THREE.GLTFLoader();
  let model = null;

  loader.load('models/test.glb',
    (gltf) => {
      model = gltf.scene;

      // Center & scale to ~unit, then rest on ground(y=0)
      const preBox = new THREE.Box3().setFromObject(model);
      const preSize = new THREE.Vector3(); preBox.getSize(preSize);
      const preCenter = new THREE.Vector3(); preBox.getCenter(preCenter);
      const maxDim = Math.max(preSize.x, preSize.y, preSize.z) || 1.0;
      const scale = 1.2 / maxDim;
      model.scale.setScalar(scale);
      model.position.sub(preCenter.multiplyScalar(scale));

      const box = new THREE.Box3().setFromObject(model);
      model.position.y -= box.min.y; // bottom at y=0

      // Shadow + dim reflections
      model.traverse((o)=>{
        if (o.isMesh){
          o.castShadow = true;
          if (o.material && 'envMapIntensity' in o.material) o.material.envMapIntensity = 0.22;
        }
      });

      stage.add(model);

      // Fit contact shadow circle to model footprint
      const tight = new THREE.Box3().setFromObject(model);
      const size = new THREE.Vector3(); tight.getSize(size);
      const radius = Math.max(size.x, size.z) * 0.62;      // footprint radius
      contactMesh.scale.set(radius, 1, radius);

      // tighten shadow camera
      keyLight.target.position.set(0, stage.position.y, 0);
      const r = Math.max(size.x, size.z) * 0.75 + 0.6;
      keyLight.shadow.camera.left   = -r;
      keyLight.shadow.camera.right  =  r;
      keyLight.shadow.camera.top    =  r;
      keyLight.shadow.camera.bottom = -r;
      keyLight.shadow.camera.near   = 0.1;
      keyLight.shadow.camera.far    = 10;

      modelProgress = 1; updateProgress();

      // Hide loader, then show Entry card
      setTimeout(()=> {
        loaderEl.classList.add('hide');
        setTimeout(()=> entryEl?.classList.remove('hide'), 180);
      }, 250);

      animate();
    },
    (xhr) => {
      modelProgress = xhr && xhr.total ? xhr.loaded / xhr.total : Math.min(1, modelProgress + 0.02);
      updateProgress();
    },
    (err) => { console.error('Model load error', err); modelProgress = 1; updateProgress(); loaderEl.classList.add('hide'); entryEl?.classList.remove('hide'); }
  );

  // Entry behavior
  if (enterBtn && entryEl) {
    enterBtn.addEventListener('click', ()=>{
      entryEl.classList.add('hide');
      hint.classList.add('show');
      setTimeout(()=> hint.classList.remove('show'), 2200);
    });
  }

  // Helpers
  function scrollProgress(){
    const max = document.body.scrollHeight - window.innerHeight;
    return max > 0 ? window.scrollY / max : 0;
  }
  function maxOverlapRatio(){
    let maxR = 0;
    document.querySelectorAll('.wrap').forEach(sec=>{
      const r = sec.getBoundingClientRect();
      if (r.bottom <= 0 || r.top >= window.innerHeight) return;
      const visible = Math.min(window.innerHeight, r.bottom) - Math.max(0, r.top);
      const ratio = Math.max(0, Math.min(1, visible / window.innerHeight));
      if (ratio > maxR) maxR = ratio;
    });
    return maxR;
  }
  const clamp = (x,a,b)=> Math.max(a,Math.min(b,x));

  // Animate
  function animate(){
    requestAnimationFrame(animate);

    const p = scrollProgress();                 // 0–1
    const angleDeg = p * 360.0;

    if(model){
      model.rotation.y = p * Math.PI * 2;

      // Slight parallax on contact shadow with rotation (very subtle)
      const wobble = Math.sin(p * Math.PI * 2) * 0.05;
      contactMesh.rotation.z = wobble * 0.15;
    }

    // Title fade near top
    const fadePoint = window.innerHeight * 0.4;
    titleEl.style.opacity = Math.max(0, 1 - window.scrollY / fadePoint).toFixed(2);

    // Blur canvas while content overlaps
    const overlap = maxOverlapRatio();
    const blurPx  = overlap * 6;
    const dim     = 1 - overlap * 0.15;
    canvasEl.style.filter = `blur(${blurPx.toFixed(1)}px) brightness(${dim.toFixed(2)})`;

    // Photo reveal + background darken
    const startDeg = 140, endDeg = 200;
    const t = clamp((angleDeg - startDeg) / (endDeg - startDeg), 0, 1);
    revealEl.style.opacity = t.toFixed(2);
    revealEl.style.transform = `translateY(${(1 - t) * 20}px)`;
    bgDark.style.opacity = (t * 1.0).toFixed(2);

    renderer.render(scene, camera);
  }

  // Resize
  window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="data:,">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Know-Hub — Products</title>
  <style>
    :root{
      --bg-light:#f7f7f8; --bg-dark:#e3e4e8;
      --panel:#ffffff; --panel-border:#dcdde1;
      --text:#222; --muted:#666;
      --accent:#ff6a00; --accent2:#2ea8ff;
    }
    html, body{ margin:0; background:linear-gradient(180deg,var(--bg-light),var(--bg-dark)); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; overflow-x:hidden; }

    /* Navbar */
    nav{ position:fixed; inset:16px 16px auto 16px; height:52px; display:flex; align-items:center; justify-content:space-between; padding:0 16px; z-index:80; background:rgba(255,255,255,.75); border:1px solid var(--panel-border); border-radius:14px; backdrop-filter:blur(10px); box-shadow:0 4px 16px rgba(0,0,0,.06); }
    .brand{ font-weight:700; font-size:18px; background:linear-gradient(90deg,var(--accent),var(--accent2)); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .nav-links{ display:flex; gap:12px; }
    .nav-btn{ padding:8px 14px; border-radius:10px; font-weight:500; cursor:pointer; background:#fff; border:1px solid var(--panel-border); color:var(--text); text-decoration:none; transition:background .15s ease, transform .15s ease, box-shadow .15s ease; }
    .nav-btn:hover{ background:#f0f0f0; transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,.08); }
    .nav-btn.active{ border-color:transparent; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#fff; }

    /* Title */
    header#title{ position:fixed; top:90px; left:50%; transform:translateX(-50%); z-index:70; font-size:clamp(24px,5vw,48px); font-weight:800; letter-spacing:.02em; background:rgba(255,255,255,.7); padding:10px 18px; border:1px solid var(--panel-border); border-radius:14px; box-shadow:0 4px 18px rgba(0,0,0,.08); }

    /* Right rail Lottie box (boxed together) */
    #lottieBox{
      position:fixed;
      right:16px;
      top:140px;
      width:min(520px, 42vw);
      z-index:60;
      background:var(--panel);
      border:1px solid var(--panel-border);
      border-radius:16px;
      box-shadow:0 10px 24px rgba(0,0,0,.08);
      padding:12px 12px 16px;
      display:flex;
      flex-direction:column;
      gap:10px;
      opacity:0;            /* fade in after load */
      transform:translateY(8px);
      transition:opacity .35s ease, transform .35s ease;
      pointer-events:none;  /* it’s decorative; avoid trapping scroll */
    }
    #lottieBox.show{
      opacity:1;
      transform:translateY(0);
      pointer-events:none;
    }
    #lottieTitle{
      position:sticky; top:0;
      background:linear-gradient(90deg, rgba(255,255,255,.9), rgba(255,255,255,.75));
      border:1px solid var(--panel-border);
      border-radius:12px;
      padding:8px 12px;
      font-weight:700;
      font-size:14px;
      color:var(--text);
      box-shadow:0 6px 16px rgba(0,0,0,.05);
      backdrop-filter:blur(6px);
    }
    #lottieHolder{
      width:100%;
      aspect-ratio:16/9;
      filter: drop-shadow(0 10px 24px rgba(0,0,0,.12));
      border-radius:12px;
      overflow:hidden;
    }

    /* Main content */
    .wrap{ max-width:1000px; margin:0 auto; padding:140px 20px 60px; position:relative; z-index:20; }
    section{ margin:120px 0; }
    .panel{ border-radius:16px; background:var(--panel); padding:28px; border:1px solid var(--panel-border); box-shadow:0 6px 18px rgba(0,0,0,.06); }
    .panel h2{ margin:0 0 8px 0; }
    .muted{ color:var(--muted); }

    /* Provide scroll room */
    .spacer{ height:380vh; }

    /* Loading overlay (no button) */
    #pageLoader{
      position:fixed; inset:0;
      display:grid; place-items:center;
      background:linear-gradient(180deg,var(--bg-light),var(--bg-dark));
      z-index:90;
      transition:opacity .35s ease, visibility .35s ease;
    }
    #pageLoader.hidden{ opacity:0; visibility:hidden; }

    .loaderCard{
      background:rgba(255,255,255,.85);
      border:1px solid var(--panel-border);
      border-radius:16px;
      padding:18px 22px;
      box-shadow:0 10px 24px rgba(0,0,0,.08);
      display:flex; align-items:center; gap:14px;
      font:14px ui-monospace;
      color:#333;
    }
    .spinner{
      width:18px; height:18px; border-radius:50%;
      border:3px solid #ddd; border-top-color:var(--accent2);
      animation:spin 0.9s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg); } }

    /* Loader chip (kept, but subtle) */
    #chip{ position:fixed; bottom:16px; left:16px; z-index:65; background:rgba(0,0,0,.75); color:#a7f3a7; font:12px ui-monospace; padding:6px 10px; border-radius:8px; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="brand">Know-Hub</div>
    <div class="nav-links">
      <a class="nav-btn" href="index.html">Home</a>
      <a class="nav-btn active" href="products.html">Products</a>
      <a class="nav-btn" href="#">About</a>
      <a class="nav-btn" href="#">Contact</a>
    </div>
  </nav>

  <!-- Title -->
  <header id="title">Products</header>

  <!-- Right-rail Lottie box -->
  <aside id="lottieBox" aria-hidden="true">
    <div id="lottieTitle">Demo Animation</div>
    <div id="lottieHolder"></div>
  </aside>

  <!-- Top content (left column area) -->
  <div class="wrap">
    <section class="panel">
      <h2>Scroll-scrubbed Animation</h2>
      <p class="muted">
        Drop a Lottie file in <code>/lottie</code> and name it <code>data.json</code>.
        Put the images in <code>/lottie/images</code> as <code>seq_0_0.png</code>…<code>seq_0_229.png</code>.
        As you scroll, the animation advances.
      </p>
    </section>

    <section class="panel">
      <h2>How it Works</h2>
      <p>We map page scroll (0–100%) to the animation’s frames. The animation sits in a right-rail box, and the title sticks to the top of the box while you read.</p>
    </section>
  </div>

  <div class="spacer"></div>
  <div class="wrap">
    <section class="panel">
      <h2>Room for Product Cards</h2>
      <p class="muted">Add product grids and details here; the animation keeps scrubbing until the bottom.</p>
    </section>
  </div>

  <!-- Page loading overlay (no button; auto-hides) -->
  <div id="pageLoader">
    <div class="loaderCard">
      <div class="spinner" aria-hidden="true"></div>
      <div>Loading animation…</div>
    </div>
  </div>

  <div id="chip">Loading Lottie…</div>

  <!-- Lottie library -->
  <script src="libs/lottie.min.js"></script>
  <script>
    const chip = document.getElementById('chip');
    const pageLoader = document.getElementById('pageLoader');
    const lottieBox = document.getElementById('lottieBox');

    function loadLottie(src){
      return new Promise((resolve, reject)=>{
        try{
          const anim = lottie.loadAnimation({
            container: document.getElementById('lottieHolder'),
            renderer: 'canvas',           // canvas is best for image sequences
            loop: false,
            autoplay: false,
            path: src,
            rendererSettings: {
              preserveAspectRatio: 'xMidYMid meet',
              progressiveLoad: true
            }
          });
          // Resolve when JSON parsed
          anim.addEventListener('data_ready', ()=> resolve(anim));
          anim.addEventListener('data_failed', ()=> reject(new Error('data_failed')));
          anim.addEventListener('error', (e)=> reject(e));
        }catch(e){ reject(e); }
      });
    }

    async function getSequenceFrameCount(src){
      try{
        const res = await fetch(src, { cache: 'no-store' });
        const json = await res.json();
        return (json.assets || []).filter(a => a.t === 'seq').length || null;
      }catch { return null; }
    }

    (async function init(){
      const jsonPath = 'lottie/data.json';
      let anim;
      try{
        anim = await loadLottie(jsonPath);
        chip.textContent = 'Loading images…';
      }catch(e){
        chip.textContent = 'Failed to load lottie/data.json';
        console.error(e);
        return;
      }

      // When all images are fetched, hide overlay and show the right-rail box
      // Not all builds dispatch 'loaded_images', so also set a safety timer.
      let imagesLoaded = false;
      const reveal = () => {
        if (imagesLoaded) return;
        imagesLoaded = true;
        pageLoader.classList.add('hidden');
        lottieBox.classList.add('show');
        chip.textContent = 'Scroll to scrub ↓';
      };

      anim.addEventListener('loaded_images', reveal);
      // Fallback reveal after 2.5s in case event isn't fired by this JSON/export
      setTimeout(reveal, 2500);

      // Total frames: prefer counting seq images; fallback to comp duration
      let TOTAL_FRAMES = await getSequenceFrameCount(jsonPath);
      if(!TOTAL_FRAMES){
        TOTAL_FRAMES = Math.max(1, Math.floor(anim.getDuration(true)));
      }

      // Smooth "slow" scrubbing:
      // - targetFrame follows scroll instantly
      // - currentFrame eases toward targetFrame (gives slower feel)
      let targetFrame = 0;
      let currentFrame = 0;
      const EASE = 0.12; // lower = slower catch-up

      function progress(){
        const max = document.body.scrollHeight - window.innerHeight;
        return max > 0 ? window.scrollY / max : 0;
      }

      function updateTargetFromScroll(){
        const p = Math.max(0, Math.min(1, progress()));
        targetFrame = p * (TOTAL_FRAMES - 1);
      }

      function tick(){
        // Ease toward target
        currentFrame += (targetFrame - currentFrame) * EASE;
        anim.goToAndStop(currentFrame, true);
        requestAnimationFrame(tick);
      }

      // Initial set and listeners
      updateTargetFromScroll();
      anim.goToAndStop(0, true);
      requestAnimationFrame(tick);
      window.addEventListener('scroll', updateTargetFromScroll, { passive:true });
      window.addEventListener('resize', updateTargetFromScroll);
    })();
  </script>
</body>
</html>
